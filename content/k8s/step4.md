---
title: "리소스 관리하기"
date: 2020-01-09T00:33:17+09:00
categories: ["cloud-native"]
tags: ["k8s"]
---

## 1. 리소스 이해

스케줄러의 임무는 **파드를 실행할 수 있는 충분한 리소스를 가진 노드가 존재하는가?**를 알아내는 것이다. 스케줄러는 요구사항에 명세되어 있는 쿠버네티스 리소스 요청과 상한에 의해 적합한 노드를 찾는다.

### 1.1 리소스 단위

    1. k8s cpu에서 1cpu == 일반적인 cpu
    2. 대부분 파드는 모든 cpu가 필요하지 않는다.
       cpu는 millicpus 단위로 쓰고 메모리는 바이트나
       mebibytes(MiB)로 측정된다.



exam)

    (spec.yml)
    spec:
        containers:
        - name:
                생략
        resources:  <-- 이 부분
          request:
            memory: '10Mi'
            cpu: '100m'


만약 스케줄러는 사용자가 원하는 리소스에 해당하는 노드가 없다면 여유 용량이 확보될 때까지 대기 상태로 기다린다.

또한 리소스 상한을 정해서 파드가 사용할 수 있는 최대 리소스 양을 지정한다. 만약 파드가 상한해서 리소스를 사용할려고 하면 해당 파드는 throttled(제한)되고 성능 저하가 발생한다. **리소스 상한은 애플리케이션 수요가 증가함에 따라 더 많은 리소스가 사용되는 상황에서 특정 파드가 리소스를 과다하게 사용될 경우를 저지할 수 있다.**


exam)

    (spec.yml)
    spec:
        containers:
        - name:
                생략
        resources:
          limits: <-- 이 부분
            memory: '10Mi'
            cpu: '100m'


**컨테이너에 대한 리소스 요청과 상한을 항상 지정하자. 쿠버네티스가 파드를 적절하게 스케줄링하고 관리하는데 도움이 된다.**


## 2. 컨테이너 생명 주기 관리


컨테이너화된 애플리케이션은 **스턱 상태(stuck state)**가 빈번하다. 스턱은 프로세스가 실행 중이지만 요청을 처리할 수 없는 상태를 말한다. 쿠버네티스는 이러한 상황을 감지하고 재시작하여 문제를 해결할 수 있어햐 한다.

쿠버네티스에서 **활성 프로브**를 통해서 컨테이너가 살아 있는지 확인하는 헬스 체크할 수 있다. 컨테이너 스펙에 활성 프로브를 지정한다. 만약 컨테이너의 활성 프로브가 실패하면 컨테이너를 종료하고 다시 실행한다.

활성 프로브는 애플리케이션이 시작과 동시에 설정하면 안된다. 영원히 실행되지 않은 무한 루프에 빠질 수 있다.(헬스 체크에서 실패로 판단되면 애플리케이션을 되살리기 때문이다.)

**준비성 프로브**는 쿠버네티스에 컨테이너가 준비되어 요청을 처리할 수 있는 상태인지를 알려준다. 만약 준비성 프로브가 실패하면 컨테이너는 서비스에서 제거하여 사용자 트래픽 연결을 해제한다.

## 3. ETC..

    네임스페이스는 클러스터를 논리적으로 분리하는 역할을 한다. 서로 다른 네임스페이스의 서비스를 참조하려면 SERVICE.NAMESPACE와 같은 DNS 주소를 이용한다.


